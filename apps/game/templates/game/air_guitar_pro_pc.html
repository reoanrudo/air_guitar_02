{% extends "core/base.html" %}
{% load static %}

{% block title %}Air Guitar Pro - PC Player{% endblock %}

{% block extra_js %}
<script src="{% static 'js/air-guitar-pro/webrtc-service.js' %}"></script>
<script src="{% static 'js/air-guitar-pro/particle-system.js' %}"></script>
<script src="{% static 'js/air-guitar-pro/audio-engine-pro.js' %}"></script>
<script src="{% static 'js/air-guitar-pro/pc-player.js' %}"></script>
{% endblock %}

{% block content %}
<div class="fixed inset-0 w-full h-full bg-slate-950 overflow-hidden select-none font-sans">
  <!-- スコア表示 -->
  <div class="absolute top-10 left-12 z-30 pointer-events-none flex flex-col items-start">
    <span class="text-[10px] font-black text-slate-500 tracking-[0.8em] uppercase mb-1">Score</span>
    <span
      id="score-display"
      class="text-8xl font-mono font-black text-white italic tracking-tighter drop-shadow-[0_0_30px_rgba(255,255,255,0.2)]">
      0
    </span>
  </div>

  <!-- コンボ表示 -->
  <div class="absolute bottom-40 right-14 z-30 pointer-events-none">
    <div
      id="combo-container"
      class="hidden flex flex-col items-end">
      <span
        id="combo-display"
        class="text-[14rem] font-black italic text-orange-500 leading-none drop-shadow-[0_0_80px_rgba(249,115,22,0.7)]">
        0
      </span>
      <span class="text-4xl font-black italic text-white tracking-[0.4em] -mt-10 uppercase">Combo!</span>
    </div>
  </div>

  <!-- 判定表示 -->
  <div
    id="judgement-display"
    class="absolute top-[40%] left-1/2 -translate-x-1/2 -translate-y-1/2 text-[16rem] font-black italic z-40 opacity-0 pointer-events-none">
  </div>

  <!-- メインエリア -->
  <div class="w-full h-full relative flex items-center justify-center">
    <video id="video-element" class="hidden" playsinline muted></video>
    <canvas id="canvas-element" class="w-full h-full object-cover"></canvas>

    <!-- ロード中オーバーレイ -->
    <div
      id="loading-overlay"
      class="absolute inset-0 bg-slate-950 z-50 flex flex-col items-center justify-center text-center">
      <div class="w-20 h-20 border-[8px] border-orange-500 border-t-transparent rounded-full animate-spin mb-8"></div>
      <p class="font-black text-white tracking-[1.5em] text-2xl italic animate-pulse">SETTING UP STAGE...</p>
    </div>

    <!-- 開始前オーバーレイ -->
    <div
      id="start-overlay"
      class="absolute inset-0 bg-slate-950/98 backdrop-blur-3xl z-40 flex items-center justify-center p-6 text-center hidden">
      <h1 class="text-[10rem] font-black italic text-transparent bg-clip-text bg-gradient-to-br from-orange-400 to-red-600 mb-8 tracking-tighter leading-none uppercase">
        Air Guitar<br/>PRO
      </h1>
      <p class="text-slate-400 mb-14 font-black text-2xl leading-relaxed px-16">
        右側の<span class="text-white italic underline decoration-orange-500 underline-offset-8">腰の高さ</span>で<br/>
        指を鋭く振り抜いて演奏しよう！
      </p>
      <button
        id="start-game-btn"
        class="bg-blue-600 text-white px-40 py-12 rounded-full font-black text-5xl italic hover:scale-110 active:scale-95 transition-all shadow-2xl">
        GIG START
      </button>
    </div>
  </div>

  <!-- フッター -->
  <div class="absolute bottom-8 w-full flex items-center justify-between px-16 z-20">
    <div class="flex items-center gap-8 bg-black/60 px-8 py-4 rounded-full border border-white/10 backdrop-blur-md">
      <div class="flex items-center gap-4">
        <div
          id="connection-indicator"
          class="w-3 h-3 rounded-full bg-red-500 animate-pulse"></div>
        <span
          id="connection-status"
          class="text-[10px] font-black uppercase tracking-[0.2em]">
          Linking...
        </span>
      </div>
      <div class="text-[10px] font-black text-slate-500 uppercase">Room: <span id="room-id-display">ABCD</span></div>
    </div>
    <button
      id="exit-btn"
      class="bg-white/5 hover:bg-red-600 text-white px-10 py-3 rounded-full text-[10px] font-black border border-white/10 transition-all uppercase tracking-widest">
      Abort
    </button>
  </div>
</div>
{% endblock %}
