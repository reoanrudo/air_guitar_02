{% extends "core/base.html" %}
{% load static %}

{% block title %}é€²æ—çŠ¶æ³ | VirtuTune{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/progress.css' %}">
{% endblock %}

{% block content %}
<div class="progress-container">
    <div class="progress-header">
        <h1>ã‚ãªãŸã®é€²æ—</h1>
        <p class="subtitle">ç·´ç¿’ã®æˆæœã‚’ç¢ºèªã—ã¾ã—ã‚‡ã†</p>
    </div>

    <!-- ç›®æ¨™é”æˆã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
    <div id="goal-section" class="goal-section">
        <div class="goal-card">
            <div class="goal-icon">
                {% if total_stats.goal_achieved %}
                    <span class="icon-achieved">ğŸ‰</span>
                {% else %}
                    <span class="icon-pending">ğŸ¯</span>
                {% endif %}
            </div>
            <div class="goal-content">
                <h2 id="goal-title">{% if total_stats.goal_achieved %}ç›®æ¨™é”æˆï¼{% else %}ä»Šæ—¥ã®ç›®æ¨™{% endif %}</h2>
                <div class="goal-time">
                    <span class="current-time">{{ total_stats.today_minutes }}</span>
                    <span class="separator">/</span>
                    <span class="target-time">{{ total_stats.goal_minutes }}</span>
                    <span class="unit">åˆ†</span>
                </div>
                {% if total_stats.goal_achieved %}
                    <p class="goal-message achieved">ç´ æ™´ã‚‰ã—ã„ï¼ç›®æ¨™ã‚’é”æˆã—ã¾ã—ãŸï¼</p>
                {% else %}
                    <p class="goal-message pending" id="goal-message">
                        ã‚ã¨{{ total_stats.goal_minutes|add:total_stats.today_minutes }}åˆ†ã§ç›®æ¨™é”æˆï¼
                    </p>
                {% endif %}
            </div>
        </div>

        <!-- ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ -->
        <div class="progress-bar-container">
            <div class="progress-bar-label">
                <span>é€²æ—</span>
                <span id="progress-percentage">{% widthratio total_stats.today_minutes 1 total_stats.goal_minutes %}%</span>
            </div>
            <div class="progress-bar">
                <div class="progress-bar-fill" id="progress-bar-fill" style="width: {% widthratio total_stats.today_minutes total_stats.goal_minutes 100 %}%"></div>
            </div>
        </div>
    </div>

    <!-- çµ±è¨ˆã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
    <div class="stats-section">
        <h2>ç·´ç¿’çµ±è¨ˆ</h2>
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-icon">ğŸ“Š</div>
                <div class="stat-content">
                    <h3>ç·ç·´ç¿’æ™‚é–“</h3>
                    <p class="stat-value">{{ total_stats.total_hours }}æ™‚é–“</p>
                    <p class="stat-detail">{{ total_stats.total_minutes }}åˆ†</p>
                </div>
            </div>

            <div class="stat-card">
                <div class="stat-icon">ğŸ”¥</div>
                <div class="stat-content">
                    <h3>é€£ç¶šç·´ç¿’æ—¥æ•°</h3>
                    <p class="stat-value">{{ total_stats.streak_days }}æ—¥</p>
                    <p class="stat-detail">ã‚¹ãƒˆãƒªãƒ¼ã‚¯</p>
                </div>
            </div>

            <div class="stat-card">
                <div class="stat-icon">ğŸ“…</div>
                <div class="stat-content">
                    <h3>ä»Šæ—¥ã®ç·´ç¿’</h3>
                    <p class="stat-value">{{ total_stats.today_minutes }}åˆ†</p>
                    <p class="stat-detail">å®Œäº†æ¸ˆã¿</p>
                </div>
            </div>
        </div>
    </div>

    <!-- æ—¥æ¬¡çµ±è¨ˆã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
    <div class="daily-stats-section">
        <div class="chart-header">
            <h2>ç·´ç¿’è¨˜éŒ²ã‚°ãƒ©ãƒ•</h2>
            <div class="chart-period-toggle">
                <button class="period-btn active" data-period="7">7æ—¥é–“</button>
                <button class="period-btn" data-period="30">30æ—¥é–“</button>
            </div>
        </div>
        <div class="daily-stats-chart">
            <canvas id="practiceChart"></canvas>
        </div>
        {% if not daily_stats and not monthly_stats %}
        <p class="no-sessions">ã¾ã ç·´ç¿’è¨˜éŒ²ãŒã‚ã‚Šã¾ã›ã‚“ã€‚ä»Šæ—¥ã‹ã‚‰å§‹ã‚ã¾ã—ã‚‡ã†ï¼</p>
        {% endif %}
    </div>

    <!-- æœ€è¿‘ã®ç·´ç¿’ã‚»ãƒƒã‚·ãƒ§ãƒ³ -->
    <div class="recent-sessions-section">
        <h2>æœ€è¿‘ã®ç·´ç¿’</h2>
        <div class="sessions-list" id="sessions-list">
            {% if recent_sessions %}
                {% for session in recent_sessions %}
                <div class="session-item">
                    <div class="session-date">
                        <span class="date">{{ session.started_at|date:"m/d" }}</span>
                        <span class="time">{{ session.started_at|time:"H:i" }}</span>
                    </div>
                    <div class="session-details">
                        <span class="duration">{{ session.duration_minutes }}åˆ†</span>
                        <span class="chords">{{ session.chords_practiced|join:", " }}</span>
                    </div>
                    {% if session.goal_achieved %}
                        <span class="goal-badge achieved">ç›®æ¨™é”æˆ</span>
                    {% endif %}
                </div>
                {% endfor %}
            {% else %}
                <p class="no-sessions">ã¾ã ç·´ç¿’è¨˜éŒ²ãŒã‚ã‚Šã¾ã›ã‚“ã€‚ä»Šæ—¥ã‹ã‚‰å§‹ã‚ã¾ã—ã‚‡ã†ï¼</p>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// çµ±è¨ˆãƒ‡ãƒ¼ã‚¿ã‚’JavaScriptã«æ¸¡ã™
const dailyStats = {{ daily_stats_json|safe }};
const monthlyStats = {{ monthly_stats_json|safe }};
const totalStats = {{ total_stats_json|safe }};
</script>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
<script src="{% static 'js/progress.js' %}"></script>
{% endblock %}
