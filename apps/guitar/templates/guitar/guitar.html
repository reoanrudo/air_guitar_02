{% extends "core/base.html" %}
{% load static %}

{% block title %}仮想ギター | VirtuTune{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/guitar.css' %}">
{% endblock %}

{% block content %}
<div class="guitar-container">
    <header class="guitar-header">
        <h1>仮想ギター</h1>
        <p class="guitar-subtitle">ギターの演奏を楽しみましょう</p>
    </header>

    <main class="guitar-main">
        <!-- ギターネック -->
        <div class="guitar-neck">
            <div class="fretboard">
                <!-- フレット（指板） -->
                <div class="fret fret-0"></div>
                <div class="fret fret-1"></div>
                <div class="fret fret-2"></div>
                <div class="fret fret-3"></div>

                <!-- 6本弦 -->
                <div class="string" data-string="6" data-note="E2">
                    <span class="string-label">6弦 (E)</span>
                </div>
                <div class="string" data-string="5" data-note="A2">
                    <span class="string-label">5弦 (A)</span>
                </div>
                <div class="string" data-string="4" data-note="D2">
                    <span class="string-label">4弦 (D)</span>
                </div>
                <div class="string" data-string="3" data-note="G1">
                    <span class="string-label">3弦 (G)</span>
                </div>
                <div class="string" data-string="2" data-note="B1">
                    <span class="string-label">2弦 (B)</span>
                </div>
                <div class="string" data-string="1" data-note="e1">
                    <span class="string-label">1弦 (e)</span>
                </div>
            </div>

        <!-- オーディオビジュアライザー -->
        <canvas id="audio-visualizer"></canvas>

        <!-- パーティクルエフェクト用 Canvas -->
        <canvas id="particle-canvas"></canvas>

        <!-- コンボカウンター -->
        <div class="combo-counter" id="combo-counter">0</div>

        <!-- 左手コードボードセクション -->
        <div class="left-hand-fretboard" id="left-hand-fretboard">
            <h2>左手コードボード</h2>
            <p class="fretboard-hint">左手モードでコードを選択（カメラ認識別で自動切替え）</p>
            <div class="mode-selector">
                <button id="mode-pc" class="mode-btn active">
                    <span class="mode-label">PC操作</span>
                    <span class="mode-desc">右手でストローク</span>
                </button>
                <button id="mode-mobile" class="mode-btn">
                    <span class="mode-label">スマホ操作</span>
                    <span class="mode-desc">左手でコード入力</span>
                </button>
            </div>

            <div class="fretboard-grid" id="left-hand-fretboard-grid">
                <!-- 左手コードボードが動的に生成されます -->
            </div>
        </div>

        <!-- 音声設定 -->
        <div class="audio-settings">
            <h3>音声設定</h3>
            <div class="setting-group">
                <label class="setting-label">音声モード：</label>
                <div class="setting-options">
                    <button class="audio-mode-btn active" data-mode="fm">FMシンセ（高品質）</button>
                    <button class="audio-mode-btn" data-mode="mp3">MP3（軽量）</button>
                </div>
            </div>
            <div class="setting-group">
                <label class="setting-label">音量：</label>
                <input type="range" id="audio-volume" min="0" max="100" value="85" class="volume-slider">
                <span class="volume-value">85%</span>
            </div>
        </div>
    </main>
</div>
{% endblock %}

{% block extra_js %}
<!-- Tone.js for better guitar sounds -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.js"></script>
<!-- Audio Engine for FM Synth -->
<script src="{% static 'js/audio-engine.js' %}"></script>
<!-- Particle System -->
<script src="{% static 'js/particle-system.js' %}"></script>
<!-- MediaPipe CDN -->
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/control_utils/control_utils.js" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js" crossorigin="anonymous"></script>

<script src="{% static 'js/guitar.js' %}"></script>
<script src="{% static 'js/visualizer.js' %}"></script>
<script src="{% static 'js/qr-pairing.js' %}"></script>
<script src="{% static 'js/camera.js' %}"></script>
{% endblock %}
